{% extends "base.html" %}

{% block content %}
<div class="container">
    <a href="{{ url_for('index') }}" class="back-link">
        <i class="fas fa-arrow-left"></i> Back to Home
    </a>
    
    <div class="user-profile-container">
        <div class="profile-header">
            <div class="profile-avatar">
                {{ user.username[0].upper() }}
            </div>
            <div class="profile-info">
                <h1>{{ user.username }}</h1>
                <p class="profile-channel">ðŸ“º {{ user.channel }}</p>
                {% if bio %}
                    <p class="profile-bio">{{ bio }}</p>
                {% endif %}
                
                <div class="profile-stats">
                    <div class="stat">
                        <span class="stat-number">{{ blogs|length }}</span>
                        <span class="stat-label">Posts</span>
                    </div>
                    <div class="stat">
                        <span class="stat-number">{{ followers_count }}</span>
                        <span class="stat-label">Followers</span>
                    </div>
                    <div class="stat">
                        <span class="stat-number">{{ following_count }}</span>
                        <span class="stat-label">Following</span>
                    </div>
                </div>
                
                {% if current_user and current_user != user.username %}
                    <div class="profile-actions">
                        {% if is_following %}
                            <button class="btn btn-following" onclick="unfollowUser('{{ user.username }}')">
                                <i class="fas fa-user-check"></i> Following
                            </button>
                        {% else %}
                            <button class="btn btn-primary" onclick="followUser('{{ user.username }}')">
                                <i class="fas fa-user-plus"></i> Follow
                            </button>
                        {% endif %}
                    </div>
                {% endif %}
            </div>
        </div>
        
        <div class="profile-posts">
            <h2><i class="fas fa-newspaper"></i> Posts by {{ user.username }}</h2>
            
            {% if blogs %}
                <div class="blog-grid">
                    {% for blog in blogs %}
                    <div class="blog-card">
                        <div class="card-header">
                            <div class="author-info">
                                <div class="avatar">{{ blog.author[0].upper() }}</div>
                                <div class="author-details">
                                    <strong>{{ blog.author }}</strong>
                                    <span class="post-date">{{ blog.date }}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="blog-card-body">
                            <div class="blog-text-content">
                                <h3><a href="{{ url_for('view_blog', blog_id=blog.id) }}">{{ blog.title|safe }}</a></h3>
                                <div class="blog-content">
                                    {{ blog.content[:200]|safe }}
                                    {% if blog.content|length > 200 %}...{% endif %}
                                </div>
                            </div>
                            {% if blog.images and blog.images|length > 0 %}
                            <div class="blog-thumbnail">
                                <img src="/static/uploads/{{ blog.images[0] }}" alt="{{ blog.title }}">
                            </div>
                            {% endif %}
                        </div>
                        
                        <div class="card-actions">
                            <a href="{{ url_for('view_blog', blog_id=blog.id) }}" class="read-more-btn">
                                <i class="fas fa-book-open"></i> Read More
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="no-posts">
                    <i class="fas fa-edit"></i>
                    <h3>No posts yet</h3>
                    <p>{{ user.username }} hasn't shared any posts yet.</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
function followUser(username) {
    fetch(`/follow/${username}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            location.reload();
        } else {
            alert(data.message);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Failed to follow user');
    });
}

function unfollowUser(username) {
    fetch(`/unfollow/${username}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            location.reload();
        } else {
            alert(data.message);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Failed to unfollow user');
    });
}
</script>
{% endblock %}